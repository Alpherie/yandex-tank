service: load
title: Yandex-Tank
ci:
  releases:
    my-app-release:
      title: Yandex-tank release
      flow: yandextank-release-flow
      stages:
        single:
          title: Single
      auto: true
  secret: sec-01d29tnxhn45y1vytr190qzy41
  runtime:
    sandbox-owner: LOAD
  flows:
    yandextank-release-flow:
      title: Yandextank release flow
      jobs:
        build:
          title: Build
          task: common/arcadia/ya_package
          stage: single
          input:
            packages: load/projects/yandex-tank-internal-pkg/docker_pkg.json
            resource_type: TANK_PACKAGE
            package_type: docker
            docker_push_image: true
            docker_token_vault_name: robot-lunapark-token
            docker_image_repository: load/test
            custom_version: "${context.targetRevision.hash}"
            compress_package_archive: True
            docker_user: robot-lunapark
            ignore_recurses: True
            publish_package: True
            multiple_publish: True
            multiple_publish_to: LOAD
            key_user: robot-lunapark

            
        deploy_onto_testing:
          needs: build
          title: Deploy onto testing
          task: common/deploy/release
          input:
            config:
              sandboxResourceType: TANK_PACKAGE
              commonReleaseData:
                releaseStage: testing
                releaseNotes: Release from ci
              stageName: Yandextank_testing-acceptance
